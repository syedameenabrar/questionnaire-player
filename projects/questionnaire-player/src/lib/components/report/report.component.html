<header class="header">
  <div class="toolbar">
    <mat-icon class="back-button" (click)="goBack()">keyboard_backspace</mat-icon>
  </div>
</header>

<main *ngIf="resultData">
  <div class="report-container">
    <div class="header-container">
      <p class="heading">{{surveyName}}</p>
    </div>
    <div class="buttons-left">
      <button [ngClass]="{'border-bottom-button': observationType === 'questions'}" (click)="toggleObservationType('questions')" class="switch-buttons">Questions</button>
      <button [ngClass]="{'border-bottom-button': observationType === 'criteria'}" (click)="toggleObservationType('criteria')" class="switch-buttons">Criteria</button>
    </div>

    <hr>
    <div class="buttons-right">
      <button (click)="openFilter()" class="apply-filter">Filters</button>
      <button class="apply-filter"  (click)="downloadPDF(submissionId, observationType === 'questions' ? false : true, true)"
      >Export As PDF</button>
    </div>

    <ng-container *ngIf="observationType === 'questions';else criteriaBlock">
      <div class="questions-list">
        <div *ngFor="let question of reportDetails; let qi = index" class="question-card">
          <div class="question-header">
            <p class="questionTitle">{{qi + 1}}. {{ question.question }}</p>
          </div>
          <div class="canvas-chart" *ngIf="isChartNotEmpty(question?.chart)">
            <canvas class="chart-canvas"></canvas>
          </div>
  
          <div class="question-content">
            <ng-container [ngSwitch]="question.responseType">
              <div *ngSwitchCase="'text'">
                <label>{{ question.answers[0]}}</label>
              </div>
              <div *ngSwitchCase="'date'">
                <label>{{ question.answers[0] | date }}</label>
              </div>
              <div *ngSwitchCase="'radio'">
                <label>{{ question.answers[0] }}</label>
              </div>
              <div *ngSwitchCase="'slider'">
                <label>{{ question.answers[0] }}</label>
              </div>
              <div *ngSwitchCase="'multiselect'">
                <span *ngFor="let answer of question.answers" class="chip">{{ answer }}</span>
              </div>
              <div *ngSwitchCase="'number'">
                <label>{{ question.answers[0] }}</label>
              </div>
  
              <div *ngSwitchCase="'matrix'">
                <ng-container *ngFor="let key of objectKeys(question.instanceQuestions[0]); let k = index">
                  <div class="matrix-item" *ngIf="key !== 'instanceIdentifier'">
                    <h3>{{ question.instanceQuestions[0][key].questionNumber }}. {{
                      question.instanceQuestions[0][key].question }}</h3>
  
                    <div *ngFor="let instance of question.instanceQuestions">
                      <div class="instance-card">
                        <h4>{{ instance.instanceIdentifier }}</h4>
  
                        <div *ngFor="let answer of instance[key].answers">
                          <span class="answer">{{ checkAnswerValue(answer) }}</span>
  
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
  
            </ng-container>
          </div>
  
          <div class="evidence-section" *ngIf="question.evidences && question.evidences.length">
            <h4>Evidences: {{ question.evidence_count }}</h4>
            <div class="evidence-icons">
              <div *ngFor="let evidence of question.evidences" class="iconList">
                <ng-container [ngSwitch]="evidence.extension">
                  <div *ngSwitchCase="'jpg'" (click)="openDialog(evidence.url, 'image')">üñºÔ∏è</div>
                  <div *ngSwitchCase="'png'" (click)="openDialog(evidence.url, 'image')">üñºÔ∏è</div>
                  <div *ngSwitchCase="'pdf'" (click)="openUrl(evidence.url)">üìÑ</div>
                  <div *ngSwitchCase="'mp4'" (click)="openDialog(evidence.url, 'video')">üé•</div>
                </ng-container>
              </div>
            </div>
          </div>
  
        </div>
      </div>
    </ng-container>
    <ng-template #criteriaBlock>
      <div class="questions-list">
        <div *ngFor="let questions of reportDetails" class="question-card2">
          <h4>{{questions[0]?.criteriaName}}</h4>

          <div *ngFor="let question of questions; let qi = index" class="question-card2-hover">
          <div class="question-header">
            <p class="questionTitle">{{qi + 1}}. {{ question.question }}</p>
          </div>
          <div class="canvas-chart" *ngIf="isChartNotEmpty(question?.chart)">
            <canvas class="chart-canvas"></canvas>
          </div>
  
          <div class="question-content">
            <ng-container [ngSwitch]="question.responseType">
              <div *ngSwitchCase="'text'">
                <label>{{ question.answers[0]}}</label>
              </div>
              <div *ngSwitchCase="'date'">
                <label>{{ question.answers[0] | date }}</label>
              </div>
              <div *ngSwitchCase="'radio'">
                <label>{{ question.answers[0] }}</label>
              </div>
              <div *ngSwitchCase="'slider'">
                <label>{{ question.answers[0] }}</label>
              </div>
              <div *ngSwitchCase="'multiselect'">
                <span *ngFor="let answer of question.answers" class="chip">{{ answer }}</span>
              </div>
              <div *ngSwitchCase="'number'">
                <label>{{ question.answers[0] }}</label>
              </div>
  
              <div *ngSwitchCase="'matrix'">
                <ng-container *ngFor="let key of objectKeys(question.instanceQuestions[0]); let k = index">
                  <div class="matrix-item" *ngIf="key !== 'instanceIdentifier'">
                    <h3>{{ question.instanceQuestions[0][key].questionNumber }}. {{
                      question.instanceQuestions[0][key].question }}</h3>
  
                    <div *ngFor="let instance of question.instanceQuestions">
                      <div class="instance-card">
                        <h4>{{ instance.instanceIdentifier }}</h4>
  
                        <div *ngFor="let answer of instance[key].answers">
                          <span class="answer">{{ checkAnswerValue(answer) }}</span>
  
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
  
            </ng-container>
          </div>
  
          <div class="evidence-section" *ngIf="question.evidences && question.evidences.length">
            <h4>Evidences: {{ question.evidence_count }}</h4>
            <div class="evidence-icons">
              <div *ngFor="let evidence of question.evidences" class="iconList">
                <ng-container [ngSwitch]="evidence.extension">
                  <div *ngSwitchCase="'jpg'" (click)="openDialog(evidence.url, 'image')">üñºÔ∏è</div>
                  <div *ngSwitchCase="'png'" (click)="openDialog(evidence.url, 'image')">üñºÔ∏è</div>
                  <div *ngSwitchCase="'pdf'" (click)="openUrl(evidence.url)">üìÑ</div>
                  <div *ngSwitchCase="'mp4'" (click)="openDialog(evidence.url, 'video')">üé•</div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
  
        </div>
      </div>
    </ng-template>

    <div *ngIf="isFilterModalOpen" class="modal">
      <div class="modal-content">
        <header>
          <h2>Select Questions to filter</h2>
          <mat-icon (click)="closeFilter()">close</mat-icon>
        </header>
        <div>
          <ul>
            <li *ngFor="let question of allQuestions">
              <input type="checkbox" [(ngModel)]="question.selected">
              <label>{{ question?.question }}</label>
            </li>
          </ul>
        </div>
        <footer class="question-footer">
          <button (click)="applyFilter()" class="apply-filter">Apply Filters</button>
        </footer>
      </div>
    </div>

    <div *ngIf="isModalOpen" class="modal">
      <div class="modal-content">
        <header>
          <h2>Preview</h2>
          <button (click)="closeDialog()">Close</button>
        </header>
        <div>
          <img *ngIf="objectType == 'image'" [src]="objectURL" alt="Preview">
          <video *ngIf="objectType == 'video'" [src]="objectURL" controls></video>
          <iframe *ngIf="objectType == 'pdf'" [src]="objectURL | sanitizeUrl"></iframe>
        </div>
      </div>
    </div>
  </div>
</main>